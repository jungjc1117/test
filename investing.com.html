<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>가상 실시간 주가 데이터 테이블 (Mocking)</title>
    <style>
      /* 테이블 스타일은 이전과 동일 */
      #stock-table {
        width: 80%;
        margin: 20px auto;
        border-collapse: collapse;
        font-family: Arial, sans-serif;
      }
      #stock-table th,
      #stock-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: right;
      }
      #stock-table th {
        background-color: #f2f2f2;
        text-align: left;
      }
      .positive {
        color: green;
        font-weight: bold;
      }
      .negative {
        color: red;
        font-weight: bold;
      }
      .status-bar {
        text-align: center;
        margin-bottom: 10px;
        font-size: 1.1em;
      }
    </style>
  </head>
  <body>
    <div class="status-bar">
      상태: <span id="ws-status">가상 데이터 업데이트 중... 🔄</span>
    </div>

    <table id="stock-table">
      <thead>
        <tr>
          <th>종목명</th>
          <th>현재가</th>
          <th>변동 ($)</th>
          <th>변동률 (%)</th>
          <th>거래량</th>
        </tr>
      </thead>
      <tbody id="table-body">
        <tr>
          <td colspan="5">초기 데이터 로드 중...</td>
        </tr>
      </tbody>
    </table>

    <script>
      // 현재 추적 중인 종목 데이터 (실제 웹소켓에서 수신하는 데이터를 대체)
      let trackedStocks = [
        {
          symbol: "AAPL",
          last: 175.2,
          changeAsNumber: 1.5,
          changePercentAsNumber: 0.86,
          volumeAbbreviated: "15M",
        },
        {
          symbol: "MSFT",
          last: 405.5,
          changeAsNumber: -0.8,
          changePercentAsNumber: -0.2,
          volumeAbbreviated: "12M",
        },
        {
          symbol: "GOOG",
          last: 150.1,
          changeAsNumber: 0.0,
          changePercentAsNumber: 0.0,
          volumeAbbreviated: "5M",
        },
      ];

      // --- 1. 테이블 UI 업데이트 함수 ---
      function updateTable(stocks) {
        const body = document.getElementById("table-body");
        body.innerHTML = "";

        stocks.forEach((stock) => {
          const row = body.insertRow();

          const change = stock.changeAsNumber;
          const changeClass =
            change > 0 ? "positive" : change < 0 ? "negative" : "";

          row.insertCell().textContent = stock.symbol;
          row.insertCell().textContent = stock.last.toFixed(2);

          const changeCell = row.insertCell();
          changeCell.textContent = change.toFixed(2);
          changeCell.classList.add(changeClass);

          const percentCell = row.insertCell();
          percentCell.textContent = `${stock.changePercentAsNumber.toFixed(
            2
          )}%`;
          percentCell.classList.add(changeClass);

          row.insertCell().textContent = stock.volumeAbbreviated;
        });
      }

      // --- 2. 가상 데이터 생성 및 업데이트 로직 (웹소켓 대체) ---
      function mockWebSocketData() {
        // 1. 모든 종목의 주가 및 변동률을 랜덤하게 업데이트합니다.
        trackedStocks = trackedStocks.map((stock) => {
          const randomChange = (Math.random() * 2 - 1) * 0.5; // -0.5 ~ +0.5 사이의 랜덤 변화
          const newLast = parseFloat((stock.last + randomChange).toFixed(2));

          // 새로운 변동값과 변동률 계산 (간단화)
          const newChange = parseFloat(
            (stock.changeAsNumber + randomChange).toFixed(2)
          );
          const newChangePercent = parseFloat(
            ((newChange / (newLast - newChange)) * 100).toFixed(2)
          );

          return {
            ...stock,
            last: newLast,
            changeAsNumber: newChange,
            changePercentAsNumber: newChangePercent,
            volumeAbbreviated:
              stock.volumeAbbreviated.replace(/[MK]/, "") * 1 +
              (Math.random() < 0.5 ? 0.1 : -0.1) +
              "M",
          };
        });

        // 2. 3초마다 새로운 가상 주가로 테이블 업데이트
        updateTable(trackedStocks);

        // 3. 재귀적으로 함수를 호출하여 지속적인 업데이트 시뮬레이션
        setTimeout(mockWebSocketData, 3000);
      }

      // --- 3. 초기 실행 ---
      updateTable(trackedStocks);
      mockWebSocketData(); // 가상 데이터 업데이트 시작
    </script>
  </body>
</html>
