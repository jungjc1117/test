<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ê°€ìƒ ì‹¤ì‹œê°„ ì£¼ê°€ ë°ì´í„° í…Œì´ë¸” (Mocking)</title>
    <style>
      /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ì€ ì´ì „ê³¼ ë™ì¼ */
      #stock-table {
        width: 80%;
        margin: 20px auto;
        border-collapse: collapse;
        font-family: Arial, sans-serif;
      }
      #stock-table th,
      #stock-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: right;
      }
      #stock-table th {
        background-color: #f2f2f2;
        text-align: left;
      }
      .positive {
        color: green;
        font-weight: bold;
      }
      .negative {
        color: red;
        font-weight: bold;
      }
      .status-bar {
        text-align: center;
        margin-bottom: 10px;
        font-size: 1.1em;
      }
    </style>
  </head>
  <body>
    <div class="status-bar">
      ìƒíƒœ: <span id="ws-status">ê°€ìƒ ë°ì´í„° ì—…ë°ì´íŠ¸ ì¤‘... ğŸ”„</span>
    </div>

    <table id="stock-table">
      <thead>
        <tr>
          <th>ì¢…ëª©ëª…</th>
          <th>í˜„ì¬ê°€</th>
          <th>ë³€ë™ ($)</th>
          <th>ë³€ë™ë¥  (%)</th>
          <th>ê±°ë˜ëŸ‰</th>
        </tr>
      </thead>
      <tbody id="table-body">
        <tr>
          <td colspan="5">ì´ˆê¸° ë°ì´í„° ë¡œë“œ ì¤‘...</td>
        </tr>
      </tbody>
    </table>

    <script>
      // í˜„ì¬ ì¶”ì  ì¤‘ì¸ ì¢…ëª© ë°ì´í„° (ì‹¤ì œ ì›¹ì†Œì¼“ì—ì„œ ìˆ˜ì‹ í•˜ëŠ” ë°ì´í„°ë¥¼ ëŒ€ì²´)
      let trackedStocks = [
        {
          symbol: "AAPL",
          last: 175.2,
          changeAsNumber: 1.5,
          changePercentAsNumber: 0.86,
          volumeAbbreviated: "15M",
        },
        {
          symbol: "MSFT",
          last: 405.5,
          changeAsNumber: -0.8,
          changePercentAsNumber: -0.2,
          volumeAbbreviated: "12M",
        },
        {
          symbol: "GOOG",
          last: 150.1,
          changeAsNumber: 0.0,
          changePercentAsNumber: 0.0,
          volumeAbbreviated: "5M",
        },
      ];

      // --- 1. í…Œì´ë¸” UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---
      function updateTable(stocks) {
        const body = document.getElementById("table-body");
        body.innerHTML = "";

        stocks.forEach((stock) => {
          const row = body.insertRow();

          const change = stock.changeAsNumber;
          const changeClass =
            change > 0 ? "positive" : change < 0 ? "negative" : "";

          row.insertCell().textContent = stock.symbol;
          row.insertCell().textContent = stock.last.toFixed(2);

          const changeCell = row.insertCell();
          changeCell.textContent = change.toFixed(2);
          changeCell.classList.add(changeClass);

          const percentCell = row.insertCell();
          percentCell.textContent = `${stock.changePercentAsNumber.toFixed(
            2
          )}%`;
          percentCell.classList.add(changeClass);

          row.insertCell().textContent = stock.volumeAbbreviated;
        });
      }

      // --- 2. ê°€ìƒ ë°ì´í„° ìƒì„± ë° ì—…ë°ì´íŠ¸ ë¡œì§ (ì›¹ì†Œì¼“ ëŒ€ì²´) ---
      function mockWebSocketData() {
        // 1. ëª¨ë“  ì¢…ëª©ì˜ ì£¼ê°€ ë° ë³€ë™ë¥ ì„ ëœë¤í•˜ê²Œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
        trackedStocks = trackedStocks.map((stock) => {
          const randomChange = (Math.random() * 2 - 1) * 0.5; // -0.5 ~ +0.5 ì‚¬ì´ì˜ ëœë¤ ë³€í™”
          const newLast = parseFloat((stock.last + randomChange).toFixed(2));

          // ìƒˆë¡œìš´ ë³€ë™ê°’ê³¼ ë³€ë™ë¥  ê³„ì‚° (ê°„ë‹¨í™”)
          const newChange = parseFloat(
            (stock.changeAsNumber + randomChange).toFixed(2)
          );
          const newChangePercent = parseFloat(
            ((newChange / (newLast - newChange)) * 100).toFixed(2)
          );

          return {
            ...stock,
            last: newLast,
            changeAsNumber: newChange,
            changePercentAsNumber: newChangePercent,
            volumeAbbreviated:
              stock.volumeAbbreviated.replace(/[MK]/, "") * 1 +
              (Math.random() < 0.5 ? 0.1 : -0.1) +
              "M",
          };
        });

        // 2. 3ì´ˆë§ˆë‹¤ ìƒˆë¡œìš´ ê°€ìƒ ì£¼ê°€ë¡œ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        updateTable(trackedStocks);

        // 3. ì¬ê·€ì ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ì§€ì†ì ì¸ ì—…ë°ì´íŠ¸ ì‹œë®¬ë ˆì´ì…˜
        setTimeout(mockWebSocketData, 3000);
      }

      // --- 3. ì´ˆê¸° ì‹¤í–‰ ---
      updateTable(trackedStocks);
      mockWebSocketData(); // ê°€ìƒ ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹œì‘
    </script>
  </body>
</html>
